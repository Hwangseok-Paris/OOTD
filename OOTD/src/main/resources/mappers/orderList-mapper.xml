<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="orderList-mapper"> 

   <select id="selectBrandOrderList" resultType="O_Order" parameterType="string">
	SELECT P.PRODUCT_NAME, OL.ORDER_QUANTITY, O.ORDER_NO, O.ORDER_DATE, O.TOTAL_PRICE
        FROM O_ORDER O, O_ORDER_LIST OL, PRODUCT P, MEMBER M
        WHERE O.ORDER_NO = OL.ORDER_NO
        	AND OL.PRODUCT_NO = P.PRODUCT_NO
        	AND P.MEMBER_NO = M.MEMBER_NO
        	AND P.PRODUCT_TYPE = 1
        	AND M.BRAND_NAME= #{ brand_name }
        ORDER BY O.ORDER_DATE DESC
   </select>

   <select id="selectBrandOrderDetail" resultType="O_Order" parameterType="_int">
   		SELECT A.ORDER_NO, A.MEMBER_NO, C.PRODUCT_NAME, A.ORDER_ADDRESS, A.RECEIVER_NAME, A.ORDER_DATE, B.ORDER_QUANTITY, A.TOTAL_PRICE
   		FROM O_ORDER A, O_ORDER_LIST B, PRODUCT C
   		WHERE A.ORDER_NO = B.ORDER_NO
        	AND B.PRODUCT_NO = C.PRODUCT_NO AND 
   		A.ORDER_NO = #{ order_no }
   </select>
   
   <update id="updateBrandStatus" parameterType="_int">
   		UPDATE O_ORDER 
   		SET ORDER_STATUS = 2
		WHERE ORDER_NO = #{ order_no }
   </update>
   
   <update id="updateNoBrandStatus" parameterType="_int">
   		UPDATE PURCHASE
   		SET PURCHASE_STATUS = 2
		WHERE ORDER_NO = #{ order_no }
   </update>

	<select id="selectOrderList" parameterType="string" resultType="O_Order">
		SELECT M.BRAND_NAME, P.PRODUCT_NAME, P.PRODUCT_SIZE, O.ORDER_NO, O.ORDER_DATE, O.TOTAL_PRICE, O.ORDER_STATUS 
		FROM O_ORDER O, O_ORDER_LIST OL, PRODUCT P, MEMBER M 
		WHERE O.ORDER_NO = OL.ORDER_NO AND OL.PRODUCT_NO = P.PRODUCT_NO AND O.MEMBER_NO = M.MEMBER_NO AND M.MEMBER_NAME= #{member_name}
		ORDER BY O.ORDER_DATE DESC
	</select>
	
	<select id="selectOrderDetail" parameterType="string" resultType="_int">
		SELECT O.RECEIVER_NAME, O.ORDER_ADDRESS, M.MEMBER_PHONE
		FROM O_ORDER O, O_ORDER_LIST OL, PRODUCT P, MEMBER M
		WHERE O.ORDER_NO = OL.ORDER_NO
			AND OL.PRODUCT_NO = P.PRODUCT_NO
			AND O.ORDER_NO = M.MEMBER_NO
			AND O.ORDER_NO = #{order_no}
	</select>
	
	<select id="selectSaleProductList" parameterType="string" resultType="O_Order">
		SELECT M.BRAND_NAME, P.PRODUCT_NAME, P.PRODUCT_SIZE, O.ORDER_NO, O.ORDER_DATE, O.TOTAL_PRICE, O.ORDER_STATUS
		FROM MEMBER M, PRODUCT P, O_ORDER O, O_ORDER_LIST OL
		WHERE M.MEMBER_NO = P.MEMBER_NO 
			AND O.ORDER_NO = OL.ORDER_NO
			AND OL.PRODUCT_NO = P.PRODUCT_NO
			AND M.MEMBER_NAME = #{member_name}
		ORDER BY O.ORDER_DATE ASC
	</select>
	
	<update id="updateOrderSaleStatus" parameterType="_int">
		UPDATE O_ORDER
		SET ORDER_STATUS = 2
		WHERE ORDER_NO = #{order_no}
	</update>
	
	<update id="updateOrderStatus" parameterType="_int">
		UPDATE PURCHASE
		SET PURCHASE_STATUS = 2
		WHERE ORDER_NO = #{order_no}
	</update>
	
	<select id="selectOrderStatus" parameterType="string" resultType="O_Order">
		SELECT ORDER_STATUS
		FROM O_ORDER
		WHERE ORDER_NO = #{order_no}
	</select>

	<update id="updatePurchaseStatus" parameterType="_int">
		UPDATE O_ORDER
		SET ORDER_STATUS = 3
		WHERE ORDER_NO = #{order_no}
	</update>
	
	<update id="updatefianlstatus" parameterType="_int">
		UPDATE PURCHASE
		SET PURCHASE_STATUS = 3
		WHERE ORDER_NO = #{order_no}
	</update>
	
</mapper>
